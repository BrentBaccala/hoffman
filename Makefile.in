
# Debugging
CFLAGS=-g -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

# Debugging w/optimization
#CFLAGS=-g -O3 -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV -pthread

# Debugging w/optimization and profiling
#CFLAGS=-g -pg -O3 -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV -pthread

# Debugging w/profiling
#CFLAGS=-g -pg -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV -pthread

CPPFLAGS=$(CFLAGS)

hoffman: hoffman.o probe.o egtb.o url_fopen.o
	gcc $(CFLAGS) -o hoffman $^ -L . -lreadline -lxml2 -lstdc++ -lposix-aio `curl-config --libs`
	echo set pagination 0 > .gdbinit
	grep -Hn BREAKPOINT *.c | cut -d : -f 1-2 | sed 's/^/break /' >> .gdbinit

hoffman.o: tablebase_dtd.h

tablebase_dtd.h: tablebase.dtd
	echo "char * tablebase_dtd = \"\\" > $@
	sed -e 's/"/\\"/g' -e 's/$$/\\/' $< >> $@
	echo "\";" >> $@

%.htb: %.xml
	./hoffman -g -o $@ $<
#	./hoffman -v -n Nalimov $@

# %.htb.gz: %.xml
#	./hoffman -g -o $*.htb $<
#	./hoffman -v -n Nalimov $*.htb
#	gzip $*.htb

%.gz: %
	gzip -f $<

kpk.htb.gz: kqk.htb.gz krk.htb.gz knk.htb.gz kbk.htb.gz

kqkq.htb.gz: kqk.htb.gz

kqkr.htb.gz: kqk.htb.gz krk.htb.gz
kqkn.htb.gz: kqk.htb.gz knk.htb.gz
kqkb.htb.gz: kqk.htb.gz kbk.htb.gz

kqkp.htb.gz: kqkq.htb.gz kqkr.htb.gz kqkn.htb.gz kqkb.htb.gz

krkr.htb.gz: krk.htb.gz
krkn.htb.gz: krk.htb.gz knk.htb.gz
krkb.htb.gz: krk.htb.gz kbk.htb.gz

krkp.htb.gz: kqkr.htb.gz krkr.htb.gz krkb.htb.gz krkn.htb.gz

kbkb.htb.gz: kbk.htb.gz
kbkn.htb.gz: kbk.htb.gz knk.htb.gz

kbkp.htb.gz: kqkb.htb.gz krkb.htb.gz kbkb.htb.gz kbkn.htb.gz

knkn.htb.gz: knk.htb.gz

knkp.htb.gz: kqkn.htb.gz krkn.htb.gz kbkn.htb.gz knkn.htb.gz

kpkp.htb.gz: kqkp.htb.gz krkp.htb.gz kbkp.htb.gz knkp.htb.gz

kqpk.htb.gz: kqk.htb.gz kpk.htb.gz kqqk.htb.gz kqrk.htb.gz kqbk.htb.gz kqnk.htb.gz

krpk.htb.gz: krk.htb.gz kpk.htb.gz kqrk.htb.gz krrk.htb.gz krnk.htb.gz krbk.htb.gz

kbpk.htb.gz: kbk.htb.gz kpk.htb.gz kqbk.htb.gz krbk.htb.gz kbbk.htb.gz kbnk.htb.gz

knpk.htb.gz: knk.htb.gz kpk.htb.gz kqnk.htb.gz krnk.htb.gz kbnk.htb.gz knnk.htb.gz

kppk.htb.gz: kpk.htb.gz kqpk.htb.gz krpk.htb.gz kbpk.htb.gz knpk.htb.gz
