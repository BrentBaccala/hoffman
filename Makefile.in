
# Debugging
#CFLAGS=-g -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

# Optimization
CFLAGS=-O3 -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

# Debugging w/optimization
#CFLAGS=-g -O3 -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

# Debugging w/optimization and profiling
#CFLAGS=-g -pg -O3 -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

# Debugging w/profiling
#CFLAGS=-g -pg -Wall -march=pentium-m -I ~/src/readline-5.0 -I /usr/include/libxml2 -DUSE_NALIMOV

CPPFLAGS=$(CFLAGS)

hoffman: hoffman.o probe.o egtb.o url_fopen.o zlib_fopen.o
	gcc $(CFLAGS) -o hoffman $^ -L . -lreadline -lxml2 -lstdc++ -lposix-aio `curl-config --libs`
	echo set pagination 0 > .gdbinit
	grep -Hn BREAKPOINT *.c | cut -d : -f 1-2 | sed 's/^/break /' >> .gdbinit

hoffman.o: tablebase_dtd.h

tablebase_dtd.h: tablebase.dtd
	echo "char * tablebase_dtd = \"\\" > $@
	sed -e 's/"/\\"/g' -e 's/$$/\\/' $< >> $@
	echo "\";" >> $@

%.htb: %.xml
	./hoffman -g -o $@ $<
#	./hoffman -v -n Nalimov $@

# %.htb.gz: %.xml
#	./hoffman -g -o $*.htb $<
#	./hoffman -v -n Nalimov $*.htb
#	gzip $*.htb

#%.gz: %
#	gzip -f $<

kpk.htb: kqk.htb krk.htb knk.htb kbk.htb

kqkq.htb: kqk.htb

kqkr.htb: kqk.htb krk.htb
kqkn.htb: kqk.htb knk.htb
kqkb.htb: kqk.htb kbk.htb

kqkp.htb: kqkq.htb kqkr.htb kqkn.htb kqkb.htb

krkr.htb: krk.htb
krkn.htb: krk.htb knk.htb
krkb.htb: krk.htb kbk.htb

krkp.htb: kqkr.htb krkr.htb krkb.htb krkn.htb

kbkb.htb: kbk.htb
kbkn.htb: kbk.htb knk.htb

kbkp.htb: kqkb.htb krkb.htb kbkb.htb kbkn.htb

knkn.htb: knk.htb

knkp.htb: kqkn.htb krkn.htb kbkn.htb knkn.htb

kpkp.htb: kqkp.htb krkp.htb kbkp.htb knkp.htb

kqpk.htb: kqk.htb kpk.htb kqqk.htb kqrk.htb kqbk.htb kqnk.htb

krpk.htb: krk.htb kpk.htb kqrk.htb krrk.htb krnk.htb krbk.htb

kbpk.htb: kbk.htb kpk.htb kqbk.htb krbk.htb kbbk.htb kbnk.htb

knpk.htb: knk.htb kpk.htb kqnk.htb krnk.htb kbnk.htb knnk.htb

kppk.htb: kpk.htb kqpk.htb krpk.htb kbpk.htb knpk.htb
