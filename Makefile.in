
CFLAGS= @CFLAGS@ -I /usr/include/readline @XML_CPPFLAGS@ @CURL_CFLAGS@

hoffman_OBJS = hoffman.o zlib_fopen.o @NALIMOVOBJS@ @CURLOBJS@ @FTPOBJS@

hoffman: $(hoffman_OBJS)
	@LINKER@ @CFLAGS@ -o hoffman $^ @XML_LIBS@ @CURL_LIBS@ @LIBS@
	echo set pagination 0 > .gdbinit
	grep -Hn BREAKPOINT *.c | cut -d : -f 1-2 | sed 's/^/break /' >> .gdbinit

hoffman.o: tablebase_dtd.h formats.h config.h

tablebase_dtd.h: tablebase.dtd
	echo "char * tablebase_dtd = \"\\" > $@
	sed -e 's/"/\\"/g' -e 's/$$/\\/' $< >> $@
	echo "\";" >> $@

formats.h:
	echo "const struct format entries_format = {4,2, 8, 0xff,0,8, 0x7f,9,7, 0,-1,0, 0,-1,0, -1,FORMAT_FLAG_NONE, -1};" > $@
	echo "const struct format proptable_format = {7,16, -1, 0xffff,32,16, 0xff,56,8," >> $@
	echo "					      0xffffffff,0,32, 0xffffffffffffffffLL,64,64," >> $@
	echo "					      -1,FORMAT_FLAG_NONE, -1};" >> $@

tarball:
	tar czhf hoffman.tgz Makefile hoffman.c probe.c egtb.cpp lock.h tbdecode.h url_fopen.c ftp_fopen.c zlib_fopen.c url_fopen.h ftp_fopen.h zlib_fopen.h tablebase.dtd

#%.htb: %.xml
#	./hoffman -g -o $@ $<
#	./hoffman -v -n Nalimov $@

# %.htb.gz: %.xml
#	./hoffman -g -o $*.htb $<
#	./hoffman -v -n Nalimov $*.htb
#	gzip $*.htb

#%.gz: %
#	gzip -f $<

kpk.htb: kqk.htb krk.htb knk.htb kbk.htb

kqkq.htb: kqk.htb

kqkr.htb: kqk.htb krk.htb
kqkn.htb: kqk.htb knk.htb
kqkb.htb: kqk.htb kbk.htb

kqkp.htb: kqkq.htb kqkr.htb kqkn.htb kqkb.htb

krkr.htb: krk.htb
krkn.htb: krk.htb knk.htb
krkb.htb: krk.htb kbk.htb

krkp.htb: kqkr.htb krkr.htb krkb.htb krkn.htb

kbkb.htb: kbk.htb
kbkn.htb: kbk.htb knk.htb

kbkp.htb: kqkb.htb krkb.htb kbkb.htb kbkn.htb

knkn.htb: knk.htb

knkp.htb: kqkn.htb krkn.htb kbkn.htb knkn.htb

kpkp.htb: kqkp.htb krkp.htb kbkp.htb knkp.htb

kqpk.htb: kqk.htb kpk.htb kqqk.htb kqrk.htb kqbk.htb kqnk.htb

krpk.htb: krk.htb kpk.htb kqrk.htb krrk.htb krnk.htb krbk.htb

kbpk.htb: kbk.htb kpk.htb kqbk.htb krbk.htb kbbk.htb kbnk.htb

knpk.htb: knk.htb kpk.htb kqnk.htb krnk.htb kbnk.htb knnk.htb

kppk.htb: kpk.htb kqpk.htb krpk.htb kbpk.htb knpk.htb
